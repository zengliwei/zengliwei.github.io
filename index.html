<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <base href="/"/>
    <title>我是 Zengliwei</title>
    <link rel="shortcut icon" type="image/x-icon" href="web/images/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="web/css/home.css"/>
</head>
<body>

<div class="bg" data-role="bg">
    <section>
        <div class="container" data-key="a"><img src="web/images/bg-3.jpg"/></div>
    </section>
    <section></section>
    <section></section>
    <section></section>
</div>

<main>
    <section id="profile">
        <div class="wrapper">
            <article>
                <h1>我是 Zengliwei</h1>
                <p>我是一名走在全栈开发路上的程序员。</p>
                <p>苏格拉底曾经说过：“除了自己的无知，我一无所知。（I know nothing except the fact of my ignorance.）”</p>
                <p>
                    不管别人是如何解读，对于我来说，这句话是用来时刻提醒自己，一个人的所知永远有限。特别是在现在这个信息发达的互联网时代，技术更迭日新月异。作为一个开发者，更是需要不断深化学习、开阔知识面，才能在未来的社会继续生存。</p>
                <p>学习新知识需要基础，自然离不开对旧知识的整理与甄别。这里记录了我在开发过程中遇到的问题和解决方案，以作日后参考。</p>
                <p>自学需要好的学习资源。这里收集了一些我过去中曾经访问过的，感觉不错的站点，方便以后持续深入学习。</p>
            </article>
        </div>
    </section>
    <section id="notes">

    </section>
    <section id="resources">

    </section>
    <section id="lab">

    </section>
</main>

<nav>
    <a href="#profile"><span>Profile</span></a>
    <a href="#notes"><span>Notes</span></a>
    <a href="#resources"><span>Resources</span></a>
    <a href="#lab"><span>Lab</span></a>
</nav>

<script src="web/js/require.js" type="text/javascript"></script>
<script>
    require.config({
        waitSeconds: 0,
        paths: {
            jquery: 'web/js/jquery'
        }
    });

    require(['jquery'], function ($) {

        const $win = $(window);
        const $doc = $(document);
        const $bg = $('[data-role="bg"]');
        const $main = $('body > main');
        const $nav = $('body > nav');
        const $bgSections = $bg.find('section');
        const $sections = $main.find('section');

        let currentSection = 0;
        let winW, winH;

        const updateStage = function () {
            const dividerRatio = 0.4;
            $sections.each(function (i, el) {
                const $el = $(el);
                const elTop = $el.offset().top;
                const elBottom = elTop + $el.outerHeight();
                const scrollTop = $win.scrollTop();
                const dividerY = winH * dividerRatio;

                if (elBottom - scrollTop <= dividerY) {
                    $el.addClass('read');
                    $bgSections.eq(i).addClass('read');
                } else {
                    $el.removeClass('read');
                    $bgSections.eq(i).removeClass('read');
                }

                if (elTop - scrollTop <= dividerY
                    && elBottom - scrollTop > dividerY
                ) {
                    currentSection = i;
                    $el.addClass('current').siblings().removeClass('current');
                    $bgSections.eq(i).addClass('current').siblings().removeClass('current');
                    $nav.find('a').eq(i).addClass('current').siblings().removeClass('current');
                }
            });
        };
        $doc.on('scroll', updateStage);

        const intStage = function () {
            winW = $win.outerWidth();
            winH = $win.outerHeight();
            updateStage();
        };
        $(window).on('resize', intStage);

        $nav.find('a').on('click', function (evt) {
            $('html, body').animate({
                scrollTop: $(evt.currentTarget.hash).offset().top
            }, {duration: 1000});
            return false;
        });

        /**
         * Section A initialization
         */
        const initSectionA = function () {
            const $containerA = $bgSections.find('.container').eq(0);
            const $sectionA = $sections.eq(0);
            const ratio = 0.01;

            let transformData = {
                a: {translateX: 0, translateY: 0, scale: 1}
            };

            const updateTransform = function (el) {
                const t = transformData[el.data('key')];
                el.css('transform', 'translate(' + t.translateX + 'px, ' + t.translateY + 'px) scale(' + t.scale + ')');
            };

            $doc.on('mousemove', function (evt) {
                transformData.a.translateX = (winW / 2 - evt.clientX) * ratio;
                transformData.a.translateY = (winH / 2 - evt.clientY) * ratio;
                updateTransform($containerA);
            });

            $doc.on('scroll', function (evt) {
                transformData.a.scale = 1 + $win.scrollTop() / $sectionA.outerHeight() * 0.2;
                updateTransform($containerA);
            });
        };

        initSectionA();
        intStage();

    });
</script>
</body>
</html>