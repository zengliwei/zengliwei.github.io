<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>
    <base href="/"/>
    <title>我是 Zengliwei</title>
    <link rel="shortcut icon" type="image/x-icon" href="web/images/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="web/css/home.css"/>
</head>
<body>

<div class="bg" data-role="bg">
    <section class="profile">
        <div class="container" data-key="a"><img src="web/images/bg-profile.jpg"/></div>
    </section>
    <section class="notes">
        <div id="starry-sky"></div>
    </section>
    <section class="resources"></section>
    <section class="lab"></section>
</div>

<main>
    <section id="profile">
        <div class="wrapper">
            <article>
                <h1>我是 Zengliwei</h1>
                <p>我是一名走在全栈开发路上的程序员。</p>
                <p>苏格拉底说过：“除了自己的无知，我一无所知。（I know nothing except the fact of my ignorance.）”</p>
                <p>
                    不管别人是如何解读，对于我来说，这句话是用来时刻提醒自己，一个人的所知永远有限。特别是在现在这个信息发达的互联网时代，技术更迭日新月异。作为一个开发者，更是需要不断深化学习、开阔知识面，才能在未来的社会继续生存。</p>
                <p>学习新知识需要基础，自然离不开对旧知识的整理与甄别。这里记录了我在开发过程中遇到的问题和解决方案，以作日后参考。</p>
                <p>自学需要好的资源。这里收集了一些我过去曾经访问过感觉不错的站点，方便以后持续深入学习。</p>
            </article>
        </div>
    </section>
    <section id="notes">
        <div class="wrapper">
            <h2>开发笔记 Notes</h2>
            <article class="with-bg">
                <a target="_blank" href="notes/php/common/array-to-xml.html">
                    <h3>通过给定数组获得 XML</h3>
                    <div class="summary">
                        一个项目用到 XML 作为配置文件，需要把数组形式的数据转化为 XML 格式储存。由于只要创建 XML 文件，不用进行复杂的更新操作，于是选择 SimpleXMLElement 进行开发。
                    </div>
                    <div class="info"><span>2021-09-05</span></div>
                </a>
            </article>
        </div>
    </section>
    <section id="resources">

    </section>
    <section id="lab">

    </section>
</main>

<nav>
    <a href="#profile" class="current"><span>Profile</span></a>
    <a href="#notes"><span>Notes</span></a>
    <a href="#resources"><span>Resources</span></a>
    <a href="#lab"><span>Lab</span></a>
</nav>

<script src="web/js/lib/require.js" type="text/javascript"></script>
<script src="web/js/require-config.js" type="text/javascript"></script>
<script>
    require(['jquery', '/web/js/starry-sky.js'], function ($) {

        const $win = $(window);
        const $doc = $(document);
        const $scrollBody = $('html, body');
        const $bg = $('[data-role="bg"]');
        const $main = $('body > main');
        const $nav = $('body > nav');
        const $bgSections = $bg.find('section');
        const $sections = $main.find('section');
        const dividerRatio = 0.4;

        let currentSection = 0;
        let winW, winH;

        const updateStage = function () {
            $sections.each(function (i, el) {
                const $el = $(el);
                const elTop = $el.offset().top;
                const elBottom = elTop + $el.outerHeight();
                const scrollTop = $win.scrollTop();
                const dividerY = winH * dividerRatio;

                if (elBottom - scrollTop <= dividerY) {
                    $el.addClass('read');
                    $bgSections.eq(i).addClass('read');
                } else {
                    $el.removeClass('read');
                    $bgSections.eq(i).removeClass('read');
                }

                if (elTop - scrollTop <= dividerY
                    && elBottom - scrollTop > dividerY
                ) {
                    currentSection = i;
                    $el.addClass('current').siblings().removeClass('current');
                    $bgSections.eq(i).addClass('current').siblings().removeClass('current');
                }
            });
        };

        const intStage = function () {
            winW = $win.outerWidth();
            winH = $win.outerHeight();
            updateStage();
        };

        const initActions = function () {
            $nav.find('a').on('click', function (evt) {
                $(evt.currentTarget).addClass('current').siblings().removeClass('current');
                $scrollBody.animate({
                    scrollTop: $(evt.currentTarget.hash).offset().top
                }, {duration: 1000});
                return false;
            });

            $doc.on('scroll', updateStage);
            $(window).on('resize', intStage);

            setTimeout(function () {
                $scrollBody.scrollTop(0);
            }, 100);
        };

        /**
         * Section Profile initialization
         */
        const initSectionProfile = function () {
            const $containerProfile = $bgSections.find('.container').eq(0);
            const $sectionProfile = $sections.eq(0);
            const ratio = 0.01;

            let transformData = {
                a: {translateX: 0, translateY: 0, scale: 1}
            };

            const updateTransform = function (el) {
                const t = transformData[el.data('key')];
                el.css('transform', 'translate(' + t.translateX + 'px, ' + t.translateY + 'px) scale(' + t.scale + ')');
            };

            $doc.on('mousemove', function (evt) {
                transformData.a.translateX = (winW / 2 - evt.clientX) * ratio;
                transformData.a.translateY = (winH / 2 - evt.clientY) * ratio;
                updateTransform($containerProfile);
            });

            $doc.on('scroll', function (evt) {
                transformData.a.scale = 1 + $win.scrollTop() / $sectionProfile.outerHeight() * 0.2;
                updateTransform($containerProfile);
            });
        };

        const initSectionNote = function () {
            // get sha https://api.github.com/repos/zengliwei/zengliwei.github.io/branches/master
            // get contents https://api.github.com/repos/zengliwei/zengliwei.github.io/contents/
            // get tree https://api.github.com/repos/zengliwei/zengliwei.github.io/git/trees/

            $('#starry-sky').starrySky();
        };

        initActions();
        initSectionProfile();
        initSectionNote();
        intStage();

    });
</script>
</body>
</html>