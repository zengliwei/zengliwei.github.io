<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no" />
    <base href="/" />
    <title>浮光掠影 - Zengliwei</title>
    <link rel="shortcut icon" type="image/x-icon" href="web/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="web/css/gallery.css" />
</head>
<body class="gallery">
    <header>
        <nav>
            <ul>
                <li>
                    <a href="gallery/#2017"><span>2017</span></a>
                    <ul>
                        <li><a href="gallery/#2017-02"><span>February</span></a></li>
                        <li><a href="gallery/#2017-03"><span>March</span></a></li>
                        <li><a href="gallery/#2017-04"><span>April</span></a></li>
                        <li><a href="gallery/#2017-05"><span>May</span></a></li>
                        <li><a href="gallery/#2017-06"><span>June</span></a></li>
                    </ul>
                </li>
                <li>
                    <a href="gallery/#2018"><span>2018</span></a>
                </li>
                <li>
                    <a href="gallery/#2019"><span>2019</span></a>
                </li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="section">
            <div class="box">
                <h2><span><span>浮光掠影</span></span></h2>
                <div class="cover"><a href="javascript:;"><img src="media/gallery/2017/04-a/cover.jpg" /></a></div>
            </div>
        </div>
        <div class="section">
            <div class="box">
                <h2><span><span>February 2017</span></span></h2>
                <div class="cover"><a href="javascript:;"><img src="media/gallery/2017/02/cover.jpg" /></a></div>
            </div>
        </div>
        <div class="section">
            <div class="box">
                <h2><span><span>March 2017</span></span></h2>
                <div class="cover"><a href="javascript:;"><img src="media/gallery/2017/03/cover.jpg" /></a></div>
            </div>
        </div>
    </main>
    <footer>
        <nav>
            <ul>
                <li><a href="/"><span>Home</span></a></li>
                <li><a href="/"><span>My Life</span></a></li>
                <li><a href="/"><span>About Work</span></a></li>
            </ul>
        </nav>
        <div class="copyright">
            Copyright &copy;
            <script>document.write( ( new Date ).getFullYear().toString() )</script>
            <a href="/">Zengliwei</a>
        </div>
    </footer>
    <link rel="stylesheet" type="text/css" href="web/css/jquery.fancybox.min.css" />
    <script src="web/js/jquery.js" type="text/javascript"></script>
    <script src="web/js/jquery.fancybox.min.js" type="text/javascript"></script>
    <script src="web/js/jquery.mousewheel-3.0.6.min.js" type="text/javascript"></script>
    <script>
        jQuery( function ( $ ) {
            let source = {
                '2017': {
                    '02': {
                        title: 'February',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' },
                            { name: '05.jpg' }
                        ]
                    },
                    '03': {
                        title: 'March',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' },
                            { name: '05.jpg' },
                            { name: '06.jpg' },
                            { name: '07.jpg' },
                            { name: '08.jpg' }
                        ]
                    },
                    '04-a': {
                        title: 'April',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' }
                        ]
                    },
                    '04-b': {
                        title: 'April',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' }
                        ]
                    },
                    '05': {
                        title: 'May',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' }
                        ]
                    },
                    '06': {
                        title: 'June',
                        images: [
                            { name: '01.jpg' },
                            { name: '02.jpg' },
                            { name: '03.jpg' },
                            { name: '04.jpg' }
                        ]
                    }
                },
                '2018': {},
                '2019': {}
            };

            let current = 0;
            let groups = [];
            let onAnimating = false;
            let elSections = $( 'main > .section' );

            for ( let year in source ) {
                for ( let month in source[year] ) {
                    let group = {
                        title: source[year][month]['title'] + ' ' + year,
                        cover: 'media/gallery/' + year + '/' + month + '/cover.jpg',
                        gallery: []
                    };
                    for ( let i = 0; i < source[year][month]['images'].length; i++ ) {
                        group['gallery'].push( {
                            src: 'media/gallery/' + year + '/' + month + '/' + source[year][month]['images'][i]['name'],
                            opts: {
                                thumbs: { autoStart: true },
                                thumb: 'media/gallery/' + year + '/' + month + '/thumb/' + source[year][month]['images'][i]['name']
                            }
                        } );
                    }
                    groups.push( group );
                }
            }

            let switchGallery = function ( dir ) {
                if ( onAnimating ) {
                    return;
                }
                let tmp = current - dir;
                if ( tmp == -1 || tmp == groups.length - 3 ) {
                    return;
                }
                current = tmp;
                onAnimating = true;
                let completed = 0;
                elSections.each( function ( i, el ) {
                    el = $( el );
                    let orgBox = el.find( '.box' );
                    let num = current + i;
                    let newBox = $( '<div class="box"></div>' );
                    let html = '<h2><span><span>' + groups[num]['title'] + '</span></span></h2>' +
                        '<div class="cover"><a href="javascript:;"><img src="' + groups[num]['cover'] + '" /></a></div>';
                    newBox.append( html ).css( { top: ( dir == 1 ? '-' : '' ) + '100%', zIndex: 2 } );
                    el.append( newBox );
                    newBox.animate( { top: 0 }, {
                        complete: function () {
                            orgBox.remove();
                            newBox.css( { zIndex: 1 } );
                            if ( ++completed == elSections.length ) {
                                onAnimating = false;
                            }
                        }
                    } );
                    if ( i === 1 ) {
                        newBox.find( 'a' ).on( 'click', function () {
                            $.fancybox.open( groups[num]['gallery'] );
                        } );
                    }
                } );
            };

            $( document ).on( 'mousewheel', function ( evt, dir ) {
                switchGallery( dir > 0 ? -1 : 1 );
            } );
        } );
    </script>
</body>
</html>